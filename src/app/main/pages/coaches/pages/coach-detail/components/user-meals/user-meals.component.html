<div class="flex justify-content-end">
  <hs-button size="medium" class="mt-14" (click)="updateUser()" [text]="'Оновити користувача'"></hs-button>
</div>

<form [formGroup]="formGroup" (ngSubmit)="onSubmit()">
  <div formArrayName="days">

    <div *ngFor="let day of days.controls; let i = index" [formGroupName]="i">

      <h1 class="fc-primary pb-12">День {{i + 1}}</h1>
      <div class="w-100 flex   pb-12">
        <p><b class="fc-primary">Загальна кількість калорій за день: {{calculateTotalCaloriesForDay(day)}}</b></p>
      </div>
      <div formArrayName="meals">
        <div class="bk-tab mb-12" *ngFor="let exercise of day.get('meals').controls; let j = index" [formGroupName]="j">
          <h4 class="pb-8">Прийом їжі {{j + 1}}</h4>

          <div class="flex bk-two-fields">
            <hs-form-field class="w-100">
              <hs-label>Назва</hs-label>
              <input iqInput formControlName="name" />
            </hs-form-field>
          </div>

          <div formArrayName="meals" style="max-width: 420px;">
            <div *ngFor="let meal of exercise.get('meals').controls; let k = index" [formGroupName]="k" style="min-width: 400px;" class="mr-8">
              <div class="flex">
                <hs-form-field class="w-100">
                  <hs-label>Інградієнт {{k + 1}}</hs-label>
                  <hs-select [enableSearch]="true" #select [dropdownMinWidth]="200" formControlName="meal" (selectionChange)="calculateNutrients(i, j)">
                    <hs-select-trigger>
                      <div style="width: 50px;">
                          {{select.triggerValue}}
                      </div>
                    </hs-select-trigger>
                    <hs-select-option *ngFor="let p of products" [value]="p.product">
                      <div class="flex">
                        <div style="width: 75%; overflow: hidden; text-overflow: ellipsis;">{{p.product}}</div>
                        <div style="width: 20%;" class="pl-12">{{p.calories}} Кал</div>
                      </div>
                    </hs-select-option>
                  </hs-select>
                </hs-form-field>

                <!-- Input for grams -->
                <hs-form-field style="width: 100px;">
                  <hs-label>Грами</hs-label>
                  <input iqInput formControlName="grams" type="number" (input)="calculateNutrients(i, j)" />
                </hs-form-field>

                <!-- Delete Ingredient Button -->
                <div class="align-items-center" style="display: flex;">
                  <hs-icon-button (click)="removeMeal(i, j, k)">
                    <i class="hs-icon icon-cross"></i>
                  </hs-icon-button>
                  <!-- <hs-button size="small" color="error"  [text]="'Видалити інгредієнт'"></hs-button> -->
                </div>
              </div>
            </div>
            <div class="flex align-items-center">
              <div>
                <hs-button size="medium" class="mt-14" (click)="addMeal(exercise)" [text]="'Додати страву'"></hs-button>
              </div>
            </div>
          </div>

          <!-- Displaying total nutrients for the meal -->
          <div class="mt-4">
            <p>Всього калорій: {{exercise.get('totalCalories').value || 0}}</p>
            <p>Всього білків: {{exercise.get('totalProteins').value || 0}}</p>
            <p>Всього жирів: {{exercise.get('totalFats').value || 0}}</p>
            <p>Всього вуглеводів: {{exercise.get('totalCarbohydrates').value || 0}}</p>
          </div>

          <div class="w-100 flex justify-content-end">
            <hs-button size="medium" class="mt-14" color="error" (click)="removeExercise(i, j)" [text]="'Видалити прийом їжі'"></hs-button>
          </div>
        </div>
        <hs-button size="medium" class="mt-14" (click)="addExercise(i)" [text]="'Додати прийом їжі'"></hs-button>
      </div>

      <div class="w-100 flex justify-content-end">
        <hs-button size="medium" color="error" class="mt-14" (click)="removeDay(i)" [text]="'Видалити день'"></hs-button>
      </div>
      <div class="hs-splitter w-100 mt-32 mb-32"></div>
    </div>
  </div>
  <hs-button size="medium" color="success" class="mt-14" (click)="addDay()" [text]="'Додати день'"></hs-button>
</form>
